<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usada Yeh - Pengobatan Tradisional Bali</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Style untuk Sidebar */
        #sidebar {
            transition: transform 0.3s ease-in-out;
        }
        #sidebar.hidden {
            transform: translateX(100%);
        }
        #sidebar-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        #sidebar-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        /* Style untuk Toast Notification (di atas) */
        #toast {
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(-200%);
        }
        #toast.visible {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="root"></div>
    
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <div id="sidebar" class="fixed top-0 right-0 w-64 h-full bg-white shadow-lg z-50 hidden"></div>

    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg z-50"></div>

    <script>
        // --- SIMULASI DATABASE (Berdasarkan file nana.sql) ---
        const db = {
            penyakit: [
                { id_penyakit: 1, jenis_penyakit: 'Panas' },
                { id_penyakit: 2, jenis_penyakit: 'Sakit Mata' },
                { id_penyakit: 3, jenis_penyakit: 'Sakit Perut' },
                { id_penyakit: 4, jenis_penyakit: 'Sakit Kepala' },
                { id_penyakit: 5, jenis_penyakit: 'Jampi' },
                { id_penyakit: 6, jenis_penyakit: 'Sakit Persendian' },
                { id_penyakit: 7, jenis_penyakit: 'Cekutan' },
                { id_penyakit: 8, jenis_penyakit: 'Obat penawar ludra kuta (Cetik)' },
                { id_penyakit: 9, jenis_penyakit: 'Obat Kunda Wijaya (Cetik)' },
                { id_penyakit: 10, jenis_penyakit: 'Obat penawar Mpu Baradah (Cetik)' },
                { id_penyakit: 11, jenis_penyakit: 'Penawar Sang Hyang Tunggal (Cetik)' },
                { id_penyakit: 12, jenis_penyakit: 'Sang Hyang Dharma (Cetik)' },
                { id_penyakit: 13, jenis_penyakit: 'Sutasoma (Cetik)' },
                { id_penyakit: 14, jenis_penyakit: 'Wisnu Murti (Cetik)' },
            ],
            // PERBAIKAN: Menggunakan jalur relatif ke folder 'images' di repositori GitHub Anda.
            // Pastikan nama file gambar di bawah ini sesuai dengan nama file yang Anda unggah.
            sarana: [
                { id_sarana: 1, deskripsi_sarana: 'Air murni dari sumber mata air.', nama_ilmiah: 'Aqua purificata', url_gambar: 'images/air-murni.jpg' },
                { id_sarana: 2, deskripsi_sarana: 'Air murni dari sumber mata air.', nama_ilmiah: 'Aqua purificata', url_gambar: 'images/air-kelapa.jpg' },
                { id_sarana: 3, deskripsi_sarana: 'Air murni dari sumber mata air.', nama_ilmiah: 'Aqua purificata', url_gambar: 'images/air-beras.jpg' },
                { id_sarana: 4, deskripsi_sarana: 'Air murni dari sumber mata air.', nama_ilmiah: 'Aqua purificata', url_gambar: 'images/air-doa.jpg' },
                { id_sarana: 5, deskripsi_sarana: 'Air murni dari sumber mata air.', nama_ilmiah: 'Aqua purificata', url_gambar: 'images/air-jeruk-nipis.jpg' },
                { id_sarana: 6, deskripsi_sarana: 'Air murni dari sumber mata air.', nama_ilmiah: 'Aqua purificata', url_gambar: 'images/air-hangat.jpg' },
                { id_sarana: 7, deskripsi_sarana: 'Pinang muda dan air dari kasimbukan.', nama_ilmiah: 'Areca catechu & Paederia foetida', url_gambar: 'images/pinang-kasimbukan.jpg' },
                { id_sarana: 8, deskripsi_sarana: 'Tempurung kelapa, lima macam bunga, air.', nama_ilmiah: 'Cocos nucifera & Flos', url_gambar: 'images/tempurung-lima-bunga.jpg' },
                { id_sarana: 9, deskripsi_sarana: 'Tempurung kelapa, bunga merah, air.', nama_ilmiah: 'Cocos nucifera & Hibiscus rosa-sinensis', url_gambar: 'images/tempurung-bunga-merah.jpg' },
                { id_sarana: 10, deskripsi_sarana: 'Tempurung kelapa hitam, bunga putih, air.', nama_ilmiah: 'Cocos nucifera & Jasminum sambac', url_gambar: 'images/tempurung-hitam-bunga-putih.jpg' },
                { id_sarana: 11, deskripsi_sarana: 'Tempurung kelapa, bunga putih, air.', nama_ilmiah: 'Cocos nucifera & Jasminum sambac', url_gambar: 'images/tempurung-bunga-putih.jpg' },
                { id_sarana: 12, deskripsi_sarana: 'Tempurung kelapa hitam dan bunga warna hitam.', nama_ilmiah: 'Cocos nucifera & Flos niger', url_gambar: 'images/tempurung-hitam-bunga-hitam.jpg' },
                { id_sarana: 13, deskripsi_sarana: 'Tempurung kelapa, bunga putih, air.', nama_ilmiah: 'Cocos nucifera & Jasminum sambac', url_gambar: 'images/tempurung-bunga-putih-jernih.jpg' },
                { id_sarana: 14, deskripsi_sarana: 'Air mumbul, tempurung kelapa, bunga wari dan bunga sudamala.', nama_ilmiah: 'Cocos nucifera & Calotropis gigantea', url_gambar: 'images/air-mumbul-sudamala.jpg' },
            ],
            mantra: [
                { id_mantra: 1, teks_mantra: 'Ong mang hang, Ung mang ang ang, uh mang ih, ong ih ah' },
                { id_mantra: 2, teks_mantra: 'Om taya ah ih, om taya I ah, Om Taya ing' },
                { id_mantra: 3, teks_mantra: 'Mang mang ung ayang, Om ing mang ang, Om taya ah' },
                { id_mantra: 4, teks_mantra: 'Om mang ah, Om mang ih, om ang ung mang ing' },
                { id_mantra: 5, teks_mantra: 'ong ih ah, om ah ih' },
                { id_mantra: 6, teks_mantra: 'ayang siang om, om mang ang siang' },
                { id_mantra: 7, teks_mantra: 'Om nama swaha' },
                { id_mantra: 8, teks_mantra: 'Om herang ing' },
                { id_mantra: 9, teks_mantra: 'Om ung ang mang ah ih, om ang ung mang ing' },
                { id_mantra: 10, teks_mantra: 'Om batara Mpu Baradah, anempur gunane I calonarang, apa angus Empu Baradah sakti, anggur wong manusa ye ki, ang sidrastru urip, teka urip' },
                { id_mantra: 11, teks_mantra: 'Om ang ung mang ing' },
                { id_mantra: 12, teks_mantra: 'Om ung ung ing ih' },
                { id_mantra: 13, teks_mantra: 'Pang ung ang mang ih' },
                { id_mantra: 14, teks_mantra: 'Om ih ung aya mang ih' },
            ],
            metode_pengobatan: [
                { id_metode: 1, metode1: 'Sembur', metode2: 'Sirat', metode3: 'Jamu/diminum', id_sarana: 1 },
                { id_metode: 2, metode1: 'Sirat', metode2: 'Sembur', metode3: 'Usapkan/raupan', id_sarana: 2 },
                { id_metode: 3, metode1: 'Jamu/diminum', metode2: 'Sirat', metode3: 'Raup', id_sarana: 3 },
                { id_metode: 4, metode1: 'Jamu/diminum', metode2: 'Sirat', metode3: 'Usapkan/raupan', id_sarana: 4 },
                { id_metode: 5, metode1: 'Sirat', metode2: 'Jamu', metode3: null, id_sarana: 5 },
                { id_metode: 6, metode1: 'Sirat', metode2: null, metode3: null, id_sarana: 6 },
                { id_metode: 7, metode1: 'Jamu', metode2: null, metode3: null, id_sarana: 7 },
                { id_metode: 8, metode1: 'Air ditaruh di dalam tempurung kelapa, diisi 5 macam bunga', metode2: null, metode3: null, id_sarana: 8 },
                { id_metode: 9, metode1: 'Air ditaruh di tempurung kelapa (sibuh) serta bunga berwarna merah', metode2: null, metode3: null, id_sarana: 9 },
                { id_metode: 10, metode1: 'Air taruh dalam tempurung kelapa yang berwarna hitam (sibuh) serta berisi bunga putih', metode2: null, metode3: null, id_sarana: 10 },
                { id_metode: 11, metode1: 'Air ditaruh dalam tempurung kelapa, bunga putih', metode2: null, metode3: null, id_sarana: 11 },
                { id_metode: 12, metode1: 'Sarana air ditaruh dalam tempurung kelapa hitam, bunga juga hitam', metode2: null, metode3: null, id_sarana: 12 },
                { id_metode: 13, metode1: 'Sarananya air yang jernih, suci, bersih, taruh dalam tempurung kelapa serta bunga putih', metode2: null, metode3: null, id_sarana: 13 },
                { id_metode: 14, metode1: 'Air mumbul ditaruh di dalam tempurung kelapa, serta bunga wari merah susun, bungan sudamala', metode2: null, metode3: null, id_sarana: 14 },
            ],
            pengobatan: [
                { id_pengobatan: 1, id_penyakit: 1, id_mantra: 1, id_metode: 1 },
                { id_pengobatan: 2, id_penyakit: 2, id_mantra: 2, id_metode: 2 },
                { id_pengobatan: 3, id_penyakit: 3, id_mantra: 3, id_metode: 3 },
                { id_pengobatan: 4, id_penyakit: 4, id_mantra: 4, id_metode: 4 },
                { id_pengobatan: 5, id_penyakit: 5, id_mantra: 5, id_metode: 5 },
                { id_pengobatan: 6, id_penyakit: 6, id_mantra: 6, id_metode: 6 },
                { id_pengobatan: 7, id_penyakit: 7, id_mantra: 7, id_metode: 7 },
                { id_pengobatan: 8, id_penyakit: 8, id_mantra: 8, id_metode: 8 },
                { id_pengobatan: 9, id_penyakit: 9, id_mantra: 9, id_metode: 9 },
                { id_pengobatan: 10, id_penyakit: 10, id_mantra: 10, id_metode: 10 },
                { id_pengobatan: 11, id_penyakit: 11, id_mantra: 11, id_metode: 11 },
                { id_pengobatan: 12, id_penyakit: 12, id_mantra: 12, id_metode: 12 },
                { id_pengobatan: 13, id_penyakit: 13, id_mantra: 13, id_metode: 13 },
                { id_pengobatan: 14, id_penyakit: 14, id_mantra: 14, id_metode: 14 },
            ],
        };

        // --- Ikon SVG ---
        const icons = {
            leaf: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 4 13H2a9 9 0 0 0 18 0h-2a7 7 0 0 1-7 7Z"></path><path d="M12 13V3"></path></svg>`,
            microscope: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 18h8"></path><path d="m3 22 7-7"></path><path d="M14 2 12 4 4 12l2 2 8-8 2-2Z"></path><path d="m18 2 4 4"></path><path d="m6 12 4-4"></path></svg>`,
            bookOpen: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2Z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7Z"></path></svg>`,
            search: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>`,
            arrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>`,
            imagePlaceholder: `<svg class="w-full h-full text-gray-300" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.997A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`,
            menu: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>`,
            close: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`,
        };
        
        const IMAGE_FALLBACK_URL = 'https://placehold.co/800x600/e2e8f0/94a3b8?text=Gambar+Tidak+Tersedia';

        // --- State and Routing ---
        const rootEl = document.getElementById('root');
        const sidebarEl = document.getElementById('sidebar');
        const sidebarOverlayEl = document.getElementById('sidebar-overlay');
        const toastEl = document.getElementById('toast');

        const navigate = (path, pushState = true) => {
            if (pushState) {
                if (`#${path}` !== window.location.hash) {
                    history.pushState({ path }, '', `#${path}`);
                }
            }
            render();
        };

        const getCurrentPath = () => {
            return window.location.hash.slice(1) || 'home';
        };

        // --- Data Helpers & Search Functions ---
        const getPengobatanDetails = (penyakitId) => {
            const pengobatanRel = db.pengobatan.find(p => p.id_penyakit === penyakitId);
            if (!pengobatanRel) return null;
            const penyakit = db.penyakit.find(p => p.id_penyakit === penyakitId);
            const mantra = db.mantra.find(m => m.id_mantra === pengobatanRel.id_mantra);
            const metode = db.metode_pengobatan.find(m => m.id_metode === pengobatanRel.id_metode);
            const sarana = db.sarana.find(s => s.id_sarana === metode.id_sarana);
            return { penyakit, mantra, metode, sarana };
        };
        
        const getSaranaDetails = (saranaId) => {
            const sarana = db.sarana.find(s => s.id_sarana === saranaId);
            if (!sarana) return null;
            const relatedPengobatan = db.metode_pengobatan
                .filter(m => m.id_sarana === saranaId)
                .map(metode => db.pengobatan.filter(p => p.id_metode === metode.id_metode).map(pr => getPengobatanDetails(pr.id_penyakit)))
                .flat().filter(Boolean);
            return { sarana, usedFor: relatedPengobatan };
        };
        
        const getMantraDetails = (mantraId) => {
            const mantra = db.mantra.find(m => m.id_mantra === mantraId);
            if (!mantra) return null;
            const relatedPengobatan = db.pengobatan
                .filter(p => p.id_mantra === mantraId)
                .map(p => getPengobatanDetails(p.id_penyakit)).filter(Boolean);
            return { mantra, usedFor: relatedPengobatan };
        };

        const getSearchSuggestions = (query) => {
            const lowerCaseQuery = query.toLowerCase().trim();
            if (!lowerCaseQuery) return [];
            const suggestions = new Set();
            db.penyakit.filter(p => p.jenis_penyakit.toLowerCase().includes(lowerCaseQuery)).forEach(penyakit => {
                const diseaseName = penyakit.jenis_penyakit.replace(/ \(Cetik\)$/i, '').trim();
                suggestions.add(diseaseName);
                suggestions.add(`Sarana untuk ${diseaseName}`);
                suggestions.add(`Mantra untuk ${diseaseName}`);
            });
            db.sarana.filter(s => s.deskripsi_sarana.toLowerCase().includes(lowerCaseQuery) || s.nama_ilmiah.toLowerCase().includes(lowerCaseQuery)).forEach(s => {
                suggestions.add(s.deskripsi_sarana.split(',')[0]);
            });
            return Array.from(suggestions).slice(0, 7);
        };

        const performSearch = (query) => {
            const lowerCaseQuery = query.toLowerCase().trim();
            if (!lowerCaseQuery) return null;
            let results = { penyakit: [], sarana: [], mantra: [], intent: null };
            let intentMatch = lowerCaseQuery.match(/^mantra(m)? untuk (obat )?(.+)/) || lowerCaseQuery.match(/^sarana untuk (obat )?(.+)/);
            if (intentMatch) {
                const penyakitName = (intentMatch[3] || intentMatch[2]).trim();
                const foundPenyakit = db.penyakit.find(p => p.jenis_penyakit.toLowerCase().includes(penyakitName));
                if (foundPenyakit) {
                    const details = getPengobatanDetails(foundPenyakit.id_penyakit);
                    if (details) { results.intent = { type: 'penyakit_detail', data: details }; return results; }
                }
            }
            results.penyakit = db.penyakit.filter(p => p.jenis_penyakit.toLowerCase().includes(lowerCaseQuery));
            results.sarana = db.sarana.filter(s => s.deskripsi_sarana.toLowerCase().includes(lowerCaseQuery) || s.nama_ilmiah.toLowerCase().includes(lowerCaseQuery));
            results.mantra = db.mantra.filter(m => m.teks_mantra.toLowerCase().includes(lowerCaseQuery));
            if (lowerCaseQuery === 'cetik') { results.penyakit = db.penyakit.filter(p => p.jenis_penyakit.toLowerCase().includes('cetik')); }
            return results;
        };

        // --- Component Functions ---
        const HeaderComponent = (path) => `
            <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-30 p-4 flex items-center justify-between">
                <div class="flex items-center">
                    ${path !== 'home' ? `<button data-action="goBack" class="mr-4 p-2 rounded-full hover:bg-gray-200 transition-colors">${icons.arrowLeft}</button>` : ''}
                    <a href="#home" data-action="navigate" data-path="home"><h1 class="text-2xl font-bold text-emerald-800">Usada Yeh</h1></a>
                </div>
                <button data-action="openMenu" class="p-2 rounded-full hover:bg-gray-200 transition-colors">${icons.menu}</button>
            </header>
        `;
        
        const SidebarComponent = () => `
            <div class="p-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-bold text-lg text-gray-700">Menu</h2>
                    <button data-action="closeMenu" class="p-2 rounded-full hover:bg-gray-200">${icons.close}</button>
                </div>
                <nav>
                    <ul>
                        <li><a href="#feedback" data-action="navigate" data-path="feedback" class="block py-2 px-3 rounded-md hover:bg-gray-100">Beri Masukan</a></li>
                        <li><a href="#contact" data-action="navigate" data-path="contact" class="block py-2 px-3 rounded-md hover:bg-gray-100">Kontak Pengembang</a></li>
                    </ul>
                </nav>
            </div>
        `;
        
        const HomePageComponent = () => {
             const namaPengguna = "Pengguna";
             return `
                <div class="p-6 text-center bg-emerald-50">
                    <h2 class="text-3xl font-light text-gray-700">Halo, <span class="font-semibold text-emerald-700">${namaPengguna}</span></h2>
                    <p class="text-gray-500 mt-2">Selamat datang di platform edukasi pengobatan tradisional Bali.</p>
                </div>
                <div class="p-6">
                    <div class="relative mb-8 max-w-2xl mx-auto">
                        <form id="search-form">
                            <div class="relative">
                               <input id="search-input" type="text" placeholder="Cari penyakit, bahan, atau mantra..." class="w-full p-4 pl-12 border border-gray-300 rounded-full focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition" autocomplete="off" />
                                <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">${icons.search}</div>
                            </div>
                        </form>
                        <div id="suggestions-container" class="absolute z-20 w-full"></div>
                    </div>
                    <div class="mb-8 p-6 bg-white rounded-lg shadow-sm max-w-3xl mx-auto">
                        <h3 class="text-xl font-bold text-emerald-800 mb-2">Sejarah Usada Yeh</h3>
                        <p class="text-gray-600 leading-relaxed">Usada Yeh adalah bagian dari kearifan lokal Bali yang memanfaatkan kekuatan air sebagai media penyembuhan. Teknik ini menggabungkan doa (mantra), bahan-bahan alami (sarana), dan metode khusus yang diwariskan secara turun-temurun. Aplikasi ini bertujuan untuk melestarikan dan menyebarkan pengetahuan berharga ini kepada generasi sekarang.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-3xl mx-auto">
                        <a href="#pengobatan" data-action="navigate" data-path="pengobatan" class="p-6 bg-emerald-600 text-white rounded-lg shadow-md hover:bg-emerald-700 transition-all text-left flex items-start">
                            <div class="bg-white/20 p-3 rounded-full mr-4">${icons.microscope}</div>
                            <div><h3 class="text-lg font-bold">Fitur Pengobatan</h3><p class="text-sm opacity-90">Lihat daftar penyakit dan cara pengobatannya.</p></div>
                        </a>
                        <a href="#bahan" data-action="navigate" data-path="bahan" class="p-6 bg-green-600 text-white rounded-lg shadow-md hover:bg-green-700 transition-all text-left flex items-start">
                            <div class="bg-white/20 p-3 rounded-full mr-4">${icons.leaf}</div>
                            <div><h3 class="text-lg font-bold">Eksplorasi Bahan</h3><p class="text-sm opacity-90">Pelajari berbagai sarana/bahan yang digunakan.</p></div>
                        </a>
                        <a href="#mantra" data-action="navigate" data-path="mantra" class="p-6 bg-teal-600 text-white rounded-lg shadow-md hover:bg-teal-700 transition-all text-left flex items-start">
                            <div class="bg-white/20 p-3 rounded-full mr-4">${icons.bookOpen}</div>
                            <div><h3 class="text-lg font-bold">Fitur Mantram</h3><p class="text-sm opacity-90">Temukan mantra-mantra penyembuhan.</p></div>
                        </a>
                    </div>
                </div>
             `;
        };
        
        const FeedbackFormComponent = () => `
            <div class="p-6 max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Beri Masukan</h2>
                <p class="text-gray-600 mb-6">Kami sangat menghargai masukan Anda untuk pengembangan aplikasi ini.</p>
                <form id="feedback-form" action="https://formspree.io/f/mwpbzrzl" method="POST" class="space-y-4">
                    <div>
                        <label for="nama_user" class="block text-sm font-medium text-gray-700">Nama Anda</label>
                        <input type="text" id="nama_user" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                    </div>
                    <div>
                        <label for="email_user" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="email_user" name="email" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                    </div>
                    <div>
                        <label for="masukan_text" class="block text-sm font-medium text-gray-700">Saran atau Masukan</label>
                        <textarea id="masukan_text" name="message" rows="5" maxlength="500" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"></textarea>
                        <p id="char-counter" class="text-right text-sm text-gray-500 mt-1">500 karakter tersisa</p>
                    </div>
                    <div class="text-right">
                        <button id="feedback-submit-button" type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">Kirim Masukan</button>
                    </div>
                </form>
            </div>
        `;
        
        const ContactPageComponent = () => `
            <div class="p-6 max-w-3xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Kontak Pengembang</h2>
                <div class="bg-white p-6 rounded-lg shadow-sm space-y-4">
                    <div>
                        <h3 class="font-bold text-lg text-emerald-700">Kadek Dimas Agung Wisnu</h3>
                        <p class="text-gray-600">Project Manager & Lead Developer</p>
                        <p class="text-sm text-gray-500">Email: kadekdimasagungwisnu3@gmail.com</p>
                    </div>
                    <div class="border-t pt-4">
                        <h3 class="font-bold text-lg text-emerald-700">Crishtian Yegar Sahaduta Benharto</h3>
                        <p class="text-gray-600">UI/UX Designer & Researcher</p>
                        <p class="text-sm text-gray-500">Email:crishtianbenharto@gmail.com</p>
                    </div>
                </div>
            </div>
        `;

        const ListPageComponent = (title, items, pathPrefix, idKey, nameKey, subKey, icon) => {
            const itemsHtml = items.map(item => {
                const name = item[nameKey];
                const sub = subKey && item[subKey] ? `<p class="text-sm text-gray-500 italic">${item[subKey]}</p>` : '';
                const itemIconHtml = item.url_gambar 
                    ? `<div class="w-16 h-16 rounded-md overflow-hidden mr-4 bg-gray-100 flex-shrink-0"><img src="${item.url_gambar}" alt="${name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='${IMAGE_FALLBACK_URL}';"></div>` 
                    : icon ? `<div class="w-16 h-16 rounded-md mr-4 flex-shrink-0 flex items-center justify-center text-gray-400">${icon}</div>` : '';

                return `
                    <li>
                        <a href="#${pathPrefix}/${item[idKey]}" data-action="navigate" data-path="${pathPrefix}/${item[idKey]}" class="p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-emerald-50 cursor-pointer transition flex items-center">
                            ${itemIconHtml}
                            <div>
                                <p class="font-semibold text-emerald-700">${name}</p>
                                ${sub}
                            </div>
                        </a>
                    </li>
                `;
            }).join('');
            return `
                <div class="p-6 max-w-3xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">${title}</h2>
                    <ul class="space-y-3">${itemsHtml}</ul>
                </div>
            `;
        };
        
        const SearchResultsPageComponent = (query) => {
            const results = performSearch(query);
            if (!results) return `<p class="p-6 text-center text-gray-500">Silakan masukkan kata kunci pencarian.</p>`;
            
            const { penyakit, sarana, mantra, intent } = results;
            const noResults = !intent && penyakit.length === 0 && sarana.length === 0 && mantra.length === 0;

            const createResultSection = (title, items, pathPrefix, idKey, nameKey, subKey) => {
                if (items.length === 0) return '';
                const itemsHtml = items.map(item => `
                    <li>
                        <a href="#${pathPrefix}/${item[idKey]}" data-action="navigate" data-path="${pathPrefix}/${item[idKey]}" class="p-4 bg-white rounded-lg shadow-sm hover:shadow-md hover:bg-emerald-50 cursor-pointer transition block">
                            <p class="font-semibold text-emerald-700">${item[nameKey]}</p>
                            ${subKey ? `<p class="text-sm text-gray-500 italic">${item[subKey]}</p>` : ''}
                        </a>
                    </li>
                `).join('');
                return `
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">${title}</h3>
                        <ul class="space-y-3">${itemsHtml}</ul>
                    </div>
                `;
            };

            return `
                <div class="p-6 max-w-3xl mx-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Hasil Pencarian untuk: <span class="text-emerald-600">"${query}"</span></h2>
                    ${noResults ? `<p class="text-gray-500 text-center p-8 bg-gray-50 rounded-lg">Tidak ada hasil yang ditemukan.</p>` : ''}
                    ${intent ? `<div class="mb-6"><h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">Jawaban Langsung</h3><div class="bg-white rounded-lg shadow-md">${PenyakitDetailPageComponent(intent.data.penyakit.id_penyakit)}</div></div>` : ''}
                    ${createResultSection('Penyakit Ditemukan', penyakit, 'detailPenyakit', 'id_penyakit', 'jenis_penyakit')}
                    ${createResultSection('Bahan (Sarana) Ditemukan', sarana, 'detailBahan', 'id_sarana', 'deskripsi_sarana', 'nama_ilmiah')}
                    ${createResultSection('Mantra Ditemukan', mantra, 'detailMantra', 'id_mantra', 'teks_mantra')}
                </div>
            `;
        };
        
        const PenyakitDetailPageComponent = (id) => {
            const data = getPengobatanDetails(parseInt(id));
            if (!data) return `<p class="p-6 text-center text-gray-500">Data tidak ditemukan.</p>`;
            const { penyakit, sarana, metode, mantra } = data;
            const metodeList = [metode.metode1, metode.metode2, metode.metode3].filter(Boolean).map(m => `<li>${m}</li>`).join('');
            
            return `
                <div class="p-6 bg-gray-50 rounded-lg max-w-3xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">${penyakit.jenis_penyakit}</h2>
                    <div class="space-y-4">
                        <div class="w-full h-48 md:h-64 bg-gray-200 rounded-lg overflow-hidden shadow-lg">
                            <img src="${sarana.url_gambar || IMAGE_FALLBACK_URL}" alt="Gambar untuk ${sarana.deskripsi_sarana}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='${IMAGE_FALLBACK_URL}';">
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-5">
                            <div class="flex items-center mb-3">
                                <div class="text-emerald-600 mr-3">${icons.leaf}</div>
                                <h3 class="text-lg font-bold text-emerald-800">Sarana yang Digunakan</h3>
                            </div>
                            <div class="pl-8 text-gray-600 space-y-2"><p class="font-semibold">${sarana.deskripsi_sarana}</p><p class="text-sm italic">${sarana.nama_ilmiah}</p></div>
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-5">
                            <div class="flex items-center mb-3">
                                <div class="text-emerald-600 mr-3">${icons.microscope}</div>
                                <h3 class="text-lg font-bold text-emerald-800">Cara Pengobatan</h3>
                            </div>
                            <div class="pl-8 text-gray-600 space-y-2"><ul class="list-disc list-inside">${metodeList}</ul></div>
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-5">
                            <div class="flex items-center mb-3">
                                <div class="text-emerald-600 mr-3">${icons.bookOpen}</div>
                                <h3 class="text-lg font-bold text-emerald-800">Mantra</h3>
                            </div>
                            <div class="pl-8 text-gray-600 space-y-2"><p class="font-mono text-sm bg-gray-100 p-3 rounded">${mantra.teks_mantra}</p></div>
                        </div>
                    </div>
                </div>
            `;
        };
        
        const BahanDetailPageComponent = (id) => {
            const data = getSaranaDetails(id);
            if (!data) return `<p class="p-6 text-center text-gray-500">Data tidak ditemukan.</p>`;
            const { sarana, usedFor } = data;
            const uniqueUsedFor = Array.from(new Map(usedFor.map(item => [item.penyakit.id_penyakit, item])).values());
            const usedForHtml = uniqueUsedFor.length > 0 ? uniqueUsedFor.map(({ penyakit }) => `<li>${penyakit.jenis_penyakit}</li>`).join('') : `<p>Informasi penggunaan tidak tersedia.</p>`;
            
            return `
                <div class="p-6 bg-gray-50 min-h-screen max-w-3xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">${sarana.deskripsi_sarana}</h2>
                    <p class="text-lg text-gray-500 italic mb-6">${sarana.nama_ilmiah}</p>
                    <div class="space-y-4">
                        <div class="w-full h-48 md:h-64 bg-gray-200 rounded-lg overflow-hidden shadow-lg">
                           <img src="${sarana.url_gambar || IMAGE_FALLBACK_URL}" alt="Gambar untuk ${sarana.deskripsi_sarana}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='${IMAGE_FALLBACK_URL}';">
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-5">
                            <div class="flex items-center mb-3">
                                <div class="text-emerald-600 mr-3">${icons.leaf}</div>
                                <h3 class="text-lg font-bold text-emerald-800">Deskripsi</h3>
                            </div>
                            <div class="pl-8 text-gray-600 space-y-2"><p>${sarana.deskripsi_sarana}</p>${sarana.deskripsi_sarana.includes('Pinang muda') ? `<p class="mt-2 text-sm text-blue-600">Hubungan bahan: Pinang muda dikombinasikan dengan air dari kasimbukan.</p>` : ''}</div>
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-5">
                            <div class="flex items-center mb-3">
                                <div class="text-emerald-600 mr-3">${icons.microscope}</div>
                                <h3 class="text-lg font-bold text-emerald-800">Digunakan Untuk Mengobati</h3>
                            </div>
                            <div class="pl-8 text-gray-600 space-y-2"><ul class="list-disc list-inside space-y-1">${usedForHtml}</ul></div>
                        </div>
                    </div>
                </div>
            `;
        };

        const MantraDetailPageComponent = (id) => {
            const data = getMantraDetails(id);
            if (!data) return `<p class="p-6 text-center text-gray-500">Data tidak ditemukan.</p>`;
            const { mantra, usedFor } = data;
            const uniqueUsedFor = Array.from(new Map(usedFor.map(item => [item.penyakit.id_penyakit, item])).values());
            const usedForHtml = uniqueUsedFor.length > 0 ? uniqueUsedFor.map(({ penyakit }) => `<li>${penyakit.jenis_penyakit}</li>`).join('') : `<p>Informasi penggunaan tidak tersedia.</p>`;
            const saranaHtml = uniqueUsedFor.length > 0 ? Array.from(new Set(uniqueUsedFor.map(({ sarana }) => sarana.deskripsi_sarana))).map(s => `<li>${s}</li>`).join('') : `<p>Informasi bahan tidak tersedia.</p>`;

            return `
                <div class="p-6 bg-gray-50 min-h-screen max-w-3xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Detail Mantra</h2>
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <p class="font-mono text-lg text-gray-700 leading-relaxed">${mantra.teks_mantra}</p>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white rounded-lg shadow-sm p-5">
                            <div class="flex items-center mb-3">
                                <div class="text-emerald-600 mr-3">${icons.microscope}</div>
                                <h3 class="text-lg font-bold text-emerald-800">Digunakan Untuk Menyembuhkan</h3>
                            </div>
                            <div class="pl-8 text-gray-600 space-y-2"><ul class="list-disc list-inside space-y-1">${usedForHtml}</ul></div>
                        </div>
                        <div class="bg-white rounded-lg shadow-sm p-5">
                            <div class="flex items-center mb-3">
                                <div class="text-emerald-600 mr-3">${icons.leaf}</div>
                                <h3 class="text-lg font-bold text-emerald-800">Kombinasi Bahan Terkait</h3>
                            </div>
                            <div class="pl-8 text-gray-600 space-y-2"><ul class="list-disc list-inside space-y-1">${saranaHtml}</ul></div>
                        </div>
                    </div>
                </div>
            `;
        };
        
        // --- Render function and Router ---
        const render = () => {
            const path = getCurrentPath();
            const [view, param] = path.split('/');
            
            let content = '';
            
            switch (view) {
                case 'pengobatan': content = ListPageComponent('Daftar Penyakit', db.penyakit, 'detailPenyakit', 'id_penyakit', 'jenis_penyakit'); break;
                case 'detailPenyakit': content = PenyakitDetailPageComponent(param); break;
                case 'bahan': content = ListPageComponent('Eksplorasi Bahan (Sarana)', db.sarana, 'detailBahan', 'id_sarana', 'deskripsi_sarana', 'nama_ilmiah', icons.leaf); break;
                case 'detailBahan': content = BahanDetailPageComponent(parseInt(param)); break;
                case 'mantra': content = ListPageComponent('Daftar Mantra', db.mantra, 'detailMantra', 'id_mantra', 'teks_mantra'); break;
                case 'detailMantra': content = MantraDetailPageComponent(parseInt(param)); break;
                case 'search': content = SearchResultsPageComponent(decodeURIComponent(param)); break;
                case 'feedback': content = FeedbackFormComponent(); break;
                case 'contact': content = ContactPageComponent(); break;
                case 'home':
                default:
                    content = HomePageComponent();
                    break;
            }

            rootEl.innerHTML = `
                ${HeaderComponent(path)}
                <main class="fade-in">${content}</main>
                <footer class="text-center p-4 text-sm text-gray-400 mt-8">Â© 2025 Usada Yeh. Dibuat untuk tujuan edukasi.</footer>
            `;
            
            sidebarEl.innerHTML = SidebarComponent();
            attachEventListeners();
        };
        
        // --- Event Listeners Setup ---
        const attachEventListeners = () => {
             const path = getCurrentPath();
             const [view] = path.split('/');

             if (view === 'home') {
                const searchForm = document.getElementById('search-form');
                const searchInput = document.getElementById('search-input');
                const suggestionsContainer = document.getElementById('suggestions-container');

                if(searchForm) {
                    searchForm.addEventListener('submit', e => {
                        e.preventDefault();
                        const searchTerm = searchInput.value.trim();
                        if (searchTerm) {
                            navigate(`search/${encodeURIComponent(searchTerm)}`);
                        }
                    });

                    searchInput.addEventListener('input', () => {
                        const suggestions = getSearchSuggestions(searchInput.value);
                        if (suggestions.length > 0) {
                            suggestionsContainer.innerHTML = `
                                <ul class="bg-white border border-gray-200 rounded-lg mt-1 shadow-lg overflow-hidden">
                                    ${suggestions.map(s => `<li><a href="#search/${encodeURIComponent(s)}" data-action="navigate" data-path="search/${encodeURIComponent(s)}" class="p-3 hover:bg-emerald-50 cursor-pointer flex items-center text-gray-700"><span class="mr-3 text-gray-400">${icons.search}</span><span>${s}</span></a></li>`).join('')}
                                </ul>`;
                        } else {
                            suggestionsContainer.innerHTML = '';
                        }
                    });
                }
             }
             
             if (view === 'feedback') {
                const textarea = document.getElementById('masukan_text');
                const charCounter = document.getElementById('char-counter');
                const feedbackForm = document.getElementById('feedback-form');
                
                if(textarea) {
                    textarea.addEventListener('input', () => {
                        const remaining = 500 - textarea.value.length;
                        charCounter.textContent = `${remaining} karakter tersisa`;
                    });
                }
                
                if(feedbackForm) {
                    feedbackForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const form = e.target;
                        const data = new FormData(form);
                        const submitButton = document.getElementById('feedback-submit-button');
                        submitButton.disabled = true;
                        submitButton.textContent = 'Mengirim...';
                        
                        try {
                            const response = await fetch(form.action, {
                                method: form.method,
                                body: data,
                                headers: {
                                    'Accept': 'application/json'
                                }
                            });
                            if (response.ok) {
                                showToast('Terima kasih atas masukan Anda!');
                                form.reset();
                                if(charCounter) charCounter.textContent = `500 karakter tersisa`;
                            } else {
                                showToast('Oops! Terjadi kesalahan saat mengirim.', true);
                            }
                        } catch (error) {
                            showToast('Oops! Terjadi kesalahan jaringan.', true);
                        } finally {
                            submitButton.disabled = false;
                            submitButton.textContent = 'Kirim Masukan';
                        }
                    });
                }
             }
        };
        
        const showToast = (message, isError = false) => {
            toastEl.textContent = message;
            toastEl.className = `fixed top-5 left-1/2 -translate-x-1/2 text-white py-2 px-4 rounded-lg shadow-lg z-50 visible ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            
            setTimeout(() => {
                toastEl.classList.remove('visible');
            }, 3000);
        };

        // --- Global Event Delegation ---
        document.body.addEventListener('click', e => {
            let target = e.target.closest('[data-action]');
            if (!target) {
                // Hide search suggestions if click is outside
                const suggestionsContainer = document.getElementById('suggestions-container');
                const searchForm = document.getElementById('search-form');
                if (suggestionsContainer && searchForm && !searchForm.contains(e.target)) {
                    suggestionsContainer.innerHTML = '';
                }
                return;
            }

            const action = target.dataset.action;
            e.preventDefault();

            switch (action) {
                case 'goBack': 
                    history.back(); 
                    break;
                case 'openMenu':
                    sidebarEl.classList.remove('hidden');
                    sidebarOverlayEl.classList.remove('hidden');
                    break;
                case 'closeMenu':
                    sidebarEl.classList.add('hidden');
                    sidebarOverlayEl.classList.add('hidden');
                    break;
                case 'navigate':
                    navigate(target.dataset.path);
                    sidebarEl.classList.add('hidden');
                    sidebarOverlayEl.classList.add('hidden');
                    break;
            }
        });
        
        sidebarOverlayEl.addEventListener('click', () => {
            sidebarEl.classList.add('hidden');
            sidebarOverlayEl.classList.add('hidden');
        });

        // --- Initial Load & History Management ---
        window.addEventListener('popstate', () => render());
        
        // Render the initial page based on the current URL hash
        render();

    </script>
</body>
</html>
